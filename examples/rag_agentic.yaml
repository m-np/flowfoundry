schema_version: "1.0"

nodes:
  - id: retrieve
    type: strategy.retrieve
    params:
      name: chroma_query        # now under the "retrieve" family
      path: .ff_chroma          # where you ingested
      collection: docs
      k: 20

  - id: bm25
    type: strategy.rerank
    params:
      name: bm25_preselect
      top_k: 20

  - id: ce
    type: strategy.rerank
    params:
      name: cross_encoder
      model: cross-encoder/ms-marco-MiniLM-L-6-v2
      top_k: 5

  - id: prompt
    type: prompt.rag
    params: {}

  - id: answer
    type: llm.chat
    params:
      provider: openai
      model: gpt-4o-mini

edges:
  - source: retrieve
    target: bm25
  - source: bm25
    target: ce
  - source: ce
    target: prompt
  - source: prompt
    target: answer

start: retrieve
